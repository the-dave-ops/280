# תיעוד שדות מרשם משקפיים

## סקירה כללית
מסמך זה מפרט את כל השדות במודל Prescription, כולל הערכים המותרים, טווחים, וברירות מחדל.

---

## 1. נתוני מרשם לעיניים

### SPH (Sphere) - כדוריות
- **שדות**: `r` (עין ימין), `l` (עין שמאל)
- **טיפוס**: Float
- **תיאור**: ערך הכדוריות של העדשה

### CYL (Cylinder) - גליליות
- **שדות**: `cylR` (עין ימין), `cylL` (עין שמאל)
- **טיפוס**: Float
- **תיאור**: ערך הגליליות של העדשה לתיקון אסטיגמטיזם

### Axis - ציר
- **שדות**: `axR` (עין ימין), `axL` (עין שמאל)
- **טיפוס**: Float
- **טווח**: 0-180 מעלות
- **תיאור**: זווית הציר לתיקון אסטיגמטיזם

---

## 2. נתוני PRISM - פריזמה

### PRISM
- **שדות**: `prismR` (עין ימין), `prismL` (עין שמאל)
- **טיפוס**: Float
- **טווח**: 0.25 - 4.00
- **קפיצות**: 0.25
- **תיאור**: ערך הפריזמה לתיקון בעיות יישור עיניים

### IN/OUT - כיוון אופקי
- **שדות**: `inOutR` (עין ימין), `inOutL` (עין שמאל)
- **טיפוס**: String (VARCHAR 10)
- **ערכים מותרים**: `"in"`, `"out"`
- **תיאור**: כיוון הפריזמה האופקי

### UP/DOWN - כיוון אנכי
- **שדות**: `upDownR` (עין ימין), `upDownL` (עין שמאל)
- **טיפוס**: String (VARCHAR 10)
- **ערכים מותרים**: `"up"`, `"down"`
- **תיאור**: כיוון הפריזמה האנכי

---

## 3. PD - Pupillary Distance (מרחק אישונים)

### PD נפרד לכל עין
- **שדות**: `pdR` (עין ימין), `pdL` (עין שמאל)
- **טיפוס**: Float
- **טווח**: 20.00 - 40.00
- **קפיצות**: 0.5
- **תיאור**: מרחק האישון מהמרכז לכל עין

### PD כולל
- **שדה**: `pdTotal`
- **טיפוס**: Float
- **תיאור**: סכום של pdR + pdL (מחושב אוטומטית)

---

## 4. VA - Visual Acuity (חדות ראייה)

### VA
- **שדות**: `vaR` (עין ימין), `vaL` (עין שמאל)
- **טיפוס**: String (VARCHAR 50)
- **ערכים מותרים**:
  - `"6/5"`
  - `"6/6"`
  - `"6/7"`
  - `"6/8"`
  - `"6/9"`
  - `"6/12"`
  - `"6/18"`
  - `"6/24"`
  - `"6/36"`
  - `"6/120"`
- **תיאור**: חדות הראייה עם התיקון

---

## 5. גובה (Height)

### גובה העדשה
- **שדות**: `heightR` (עין ימין), `heightL` (עין שמאל)
- **טיפוס**: Float
- **טווח**: 16.00 - 35.00
- **קפיצות**: 0.5
- **תיאור**: גובה העדשה במילימטרים

---

## 6. נתונים כלליים לעדשות

### ADD - תוספת לקריאה
- **שדה**: `add`
- **טיפוס**: Float
- **תיאור**: תוספת דיופטר לקריאה (עדשות מולטיפוקל)

### Index - אינדקס שבירה
- **שדה**: `index`
- **טיפוס**: String (VARCHAR 50)
- **ברירת מחדל**: `"1.56"`
- **ערכים מותרים**:
  - `"1.5"`
  - `"1.56"` (ברירת מחדל)
  - `"1.6"`
  - `"1.67"`
  - `"1.71"`
  - `"1.74"`
  - `"1.76"`
  - `"ייצור"`
  - `"סופר פלט"`
  - `"דק סכין"`
- **תיאור**: אינדקס השבירה של העדשה (עדשות דקות יותר = אינדקס גבוה יותר)

### צבע עדשות
- **שדה**: `color`
- **טיפוס**: String (VARCHAR 255)
- **תיאור**: צבע העדשות

### אחוז צבע
- **שדה**: `colorPercentage`
- **טיפוס**: Float
- **תיאור**: אחוז הצבע בעדשות

---

## 7. נתוני מסגרת

### שם מסגרת
- **שדה**: `frameName`
- **טיפוס**: String (VARCHAR 255)
- **תיאור**: שם/מותג המסגרת

### דגם מסגרת
- **שדה**: `frameModel`
- **טיפוס**: String (VARCHAR 255)
- **תיאור**: מספר דגם המסגרת

### צבע מסגרת
- **שדה**: `frameColor`
- **טיפוס**: String (VARCHAR 255)
- **ערכים מומלצים**:
  - `"אדום"`
  - `"ירוק"`
  - `"כחול"`
  - `"חום"`
  - `"ורוד"`
  - `"זהב מט"`
  - `"זהב מבריק"`
  - `"כסף מבריק"`
  - `"כסף מט"`
  - `"ניקל"`
  - `"אפור"`
  - `"טורקיז"`
  - `"כתום"`
  - `"שחור-לבן"`
  - `"שחור"`
  - `"שקוף"`
  - `"אחר"`
- **תיאור**: צבע המסגרת

### גשר
- **שדה**: `frameBridge`
- **טיפוס**: String (VARCHAR 50)
- **תיאור**: מידת הגשר של המסגרת

### רוחב מסגרת
- **שדה**: `frameWidth`
- **טיפוס**: String (VARCHAR 50)
- **תיאור**: רוחב המסגרת

### הערות מסגרת
- **שדה**: `frameNotes`
- **טיפוס**: Text
- **תיאור**: הערות נוספות על המסגרת

---

## 8. נתונים נוספים

### סוג מרשם
- **שדה**: `type`
- **טיפוס**: String (VARCHAR 50)
- **ערכים**: `"מרחק"`, `"קריאה"`, `"עדשות מגע"`

### תאריך
- **שדה**: `date`
- **טיפוס**: DateTime
- **ברירת מחדל**: תאריך נוכחי

### קופת חולים
- **שדה**: `healthFund`
- **טיפוס**: String (VARCHAR 255)

### סוג ביטוח
- **שדה**: `insuranceType`
- **טיפוס**: String (VARCHAR 255)
- **דוגמאות**: `"מושלם"`, `"מכבי זהב"`

### מחיר
- **שדה**: `price`
- **טיפוס**: Float
- **ברירת מחדל**: 0

### מקור הנחה
- **שדה**: `discountSource`
- **טיפוס**: String (VARCHAR 255)

### סכום לתשלום
- **שדה**: `amountToPay`
- **טיפוס**: Float
- **ברירת מחדל**: 0

### שולם
- **שדה**: `paid`
- **טיפוס**: Float
- **ברירת מחדל**: 0

### יתרה
- **שדה**: `balance`
- **טיפוס**: Float
- **ברירת מחדל**: 0

### מספר קבלה
- **שדה**: `receiptNumber`
- **טיפוס**: String (VARCHAR 255)

### קמפיין 280
- **שדה**: `campaign280`
- **טיפוס**: Boolean
- **ברירת מחדל**: false

### מקור
- **שדה**: `source`
- **טיפוס**: String (VARCHAR 255)

### הערות
- **שדה**: `notes`
- **טיפוס**: Text

---

## שינויים שבוצעו

### שדות שהוסרו
- ❌ `pd` - הוחלף ב-`pdR`, `pdL`, `pdTotal`
- ❌ `frameC` - היה כפילות של `frameColor`

### שדות שנוספו
- ✅ `prismR`, `prismL` - ערכי פריזמה
- ✅ `inOutR`, `inOutL` - כיוון פריזמה אופקי
- ✅ `upDownR`, `upDownL` - כיוון פריזמה אנכי
- ✅ `pdR`, `pdL`, `pdTotal` - מרחק אישונים נפרד
- ✅ `heightR`, `heightL` - גובה עדשות
- ✅ `frameBridge` - גשר מסגרת

### שדות שעודכנו
- 🔄 `index` - נוסף ברירת מחדל `"1.56"` ורשימת ערכים מוגדרת
- 🔄 `frameColor` - נוספה רשימת ערכים מומלצים
- 🔄 `vaR`, `vaL` - נוספה רשימת ערכים מוגדרת

---

## הערות ליישום

1. **Validation**: יש ליישם בדיקות תקינות (validation) בצד הלקוח והשרת לוודא שהערכים נמצאים בטווחים המותרים.

2. **UI Components**: 
   - עבור שדות עם רשימת ערכים מוגדרת - להשתמש ב-dropdown/select
   - עבור שדות עם טווח וקפיצות - להשתמש ב-number input עם step
   - עבור שדות IN/OUT ו-UP/DOWN - להשתמש ב-radio buttons או toggle

3. **חישוב אוטומטי**: 
   - `pdTotal` צריך להתחשב אוטומטית כאשר `pdR` או `pdL` משתנים
   - `balance` צריך להתחשב אוטומטית: `balance = amountToPay - paid`

4. **תאימות לאחור**: 
   - נתונים קיימים עם `pd` הועברו ל-`pdTotal`
   - יש לעדכן את ממשק המשתמש להציג את השדות החדשים

---

## דוגמת שימוש ב-API

```typescript
// יצירת מרשם חדש עם כל השדות
const prescription = await prisma.prescription.create({
  data: {
    customerId: 1,
    type: "מרחק",
    r: -2.50,
    l: -2.75,
    cylR: -0.75,
    axR: 180,
    cylL: -0.50,
    axL: 90,
    prismR: 0.50,
    prismL: 0.25,
    inOutR: "in",
    inOutL: "out",
    upDownR: "up",
    upDownL: "down",
    pdR: 31.5,
    pdL: 32.0,
    pdTotal: 63.5,
    vaR: "6/6",
    vaL: "6/6",
    heightR: 25.0,
    heightL: 25.0,
    add: 1.50,
    index: "1.67",
    color: "חום",
    colorPercentage: 85,
    frameName: "Ray-Ban",
    frameModel: "RB5228",
    frameColor: "חום",
    frameBridge: "18",
    frameWidth: "53",
    price: 1500,
    amountToPay: 1200,
    paid: 600,
    balance: 600
  }
});
```
